<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>AI Network Troubleshooter - Live Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    body {
      background: #05071a;
      color: #f8f9ff;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      padding: 20px;
    }

    .app {
      width: 1200px;
      background: #05071a;
      border-radius: 18px;
    }

    /* Top header (buttons) */
    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }

    .top-title {
      font-size: 20px;
      font-weight: 600;
      color: #ffffff;
    }

    .page-switch {
      display: flex;
      gap: 10px;
    }

    .page-btn {
      border: none;
      padding: 8px 14px;
      border-radius: 999px;
      background: #10163a;
      color: #d0d4ff;
      cursor: pointer;
      font-size: 13px;
    }

    .page-btn.active {
      background: #4c6fff;
      color: #fff;
    }

    .timestamp {
      font-size: 12px;
      color: #8a92c4;
    }

    /* Dashboard frame */
    .dashboard-frame {
      background: #0c1131;
      border-radius: 16px;
      padding: 16px;
      box-shadow: 0 10px 35px rgba(0,0,0,0.6);
      border: 1px solid #181d45;
    }

    /* GRID */
    #page1 {
      display: grid;
      grid-template-columns: 260px 310px 1fr;
      grid-template-rows: auto auto;
      gap: 12px;
    }

    #page2 {
      display: none;
      grid-template-columns: 260px 260px 260px 1fr;
      grid-template-rows: auto 220px;
      gap: 12px;
    }

    .card {
      background: #11163d;
      border-radius: 12px;
      padding: 12px 14px;
      border: 1px solid #202554;
      position: relative;
      overflow: hidden;
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
      font-size: 13px;
      color: #a6addf;
      text-transform: uppercase;
      letter-spacing: 0.04em;
    }

    .card-header span.value {
      font-size: 12px;
      color: #f0f3ff;
      text-transform: none;
    }

    .big-number {
      font-size: 30px;
      font-weight: 600;
      margin-bottom: 8px;
    }

    .subtext {
      font-size: 12px;
      color: #9aa1d9;
    }

    .pill-alert {
      position: absolute;
      right: 10px;
      top: 34px;
      background: #ff4b5c;
      color: white;
      border-radius: 999px;
      font-size: 10px;
      padding: 2px 7px;
    }

    .list-rows {
      margin-top: 6px;
      font-size: 12px;
      max-height: 260px;
      overflow-y: auto;
    }

    .row-line {
      display: flex;
      justify-content: space-between;
      padding: 4px 0;
      border-bottom: 1px solid rgba(255,255,255,0.03);
    }

    .row-line:last-child {
      border-bottom: none;
    }

    .row-line span.label {
      color: #d5daff;
    }

    .row-line span.value {
      color: #9aa1d9;
    }

    .flex {
      display: flex;
      gap: 12px;
      align-items: stretch;
    }

    .small {
      font-size: 11px;
      color: #8b93ce;
    }

    .progress-bar-bg {
      width: 100%;
      height: 7px;
      border-radius: 999px;
      background: #1c224d;
      margin-top: 6px;
      overflow: hidden;
    }

    .progress-bar-fill {
      height: 100%;
      border-radius: 999px;
      background: linear-gradient(90deg, #4c6fff, #6affd9);
      width: 0%;
      transition: width 0.4s ease;
    }

    .chart-container {
      margin-top: 10px;
      height: 150px;
    }

    .chart-container canvas {
      width: 100% !important;
      height: 100% !important;
    }

    .table {
      width: 100%;
      border-collapse: collapse;
      font-size: 12px;
      margin-top: 6px;
    }

    .table th,
    .table td {
      padding: 4px 0;
      text-align: left;
      border-bottom: 1px solid rgba(255,255,255,0.04);
    }

    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      display: inline-block;
      margin-right: 6px;
    }
    .status-up   { background:#22c55e; }
    .status-down { background:#ef4444; }
    .status-unk  { background:#9ca3af; }

    /* Second page extras */
    .stats-big {
      font-size: 32px;
      font-weight: 600;
    }
    .two-line {
      margin-top: 4px;
      font-size: 12px;
      color: #b0b7f0;
    }
    .rating-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 4px 0;
      border-bottom: 1px solid rgba(255,255,255,0.03);
      font-size: 12px;
    }
    .stars {
      font-size: 12px;
      color: #ffd457;
      margin-right: 4px;
    }
    .rating-msg {
      color: #e1e4ff;
      margin-left: 4px;
    }
    .time {
      color: #848bc4;
      font-size: 11px;
    }
    .badge-status {
      padding: 2px 8px;
      border-radius: 999px;
      font-size: 10px;
      background: #1c224d;
      color: #cfd4ff;
    }

    /* Footer */
    .footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 10px;
      font-size: 11px;
      color: #8a92c4;
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .brand-logo {
      width: 16px;
      height: 16px;
      border-radius: 4px;
      background: #01c26f;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      font-weight: 700;
      color: #05071a;
    }

    a.btn-link {
      color:#c4d0ff;
      text-decoration:none;
      font-size:12px;
    }
  </style>
</head>
<body>
<div class="app">
  <div class="top-bar">
    <div class="top-title">AI Network Troubleshooter - Live Dashboard</div>
    <div class="page-switch">
      <button class="page-btn active" data-target="page1">Network Health</button>
      <button class="page-btn" data-target="page2">Incidents & Insights</button>
    </div>
    <div class="timestamp">
      Last server render: {{ generated_at }} &nbsp;|&nbsp;
      <span id="liveTime"></span>
    </div>
  </div>

  <div class="dashboard-frame">
    <!-- PAGE 1 -->
    <div id="page1">
      <!-- LEFT: Devices by status -->
      <div class="card">
        <div class="card-header">
          <span>Devices by status</span>
          <span class="value" id="totalDevicesLabel">Total: 0</span>
        </div>
        <div class="list-rows" id="statusList">
          <!-- JS will inject device status lines -->
        </div>
      </div>

      <!-- MIDDLE: Overall health + small cards -->
      <div class="grid" style="display:grid;grid-template-rows: 180px 120px 120px;gap:12px;">
        <!-- Network health gauge -->
        <div class="card">
          <div class="card-header">
            <span>Network health</span>
            <span class="value" id="healthLabel">Calculating...</span>
          </div>
          <div class="big-number" id="upPercentNumber">0%</div>
          <div class="subtext">Devices currently reachable</div>
          <div class="pill-alert" id="alertBadge" style="display:none;">Issues</div>

          <div class="flex" style="margin-top:12px;">
            <div style="flex:1;">
              <div class="small">UP / DOWN / UNKNOWN</div>
              <div class="chart-container">
                <canvas id="healthGauge"></canvas>
              </div>
            </div>
          </div>
        </div>

        <!-- Utilisation (simply % devices UP) -->
        <div class="card">
          <div class="card-header">
            <span>Availability</span>
            <span class="value" id="availLabel">0% UP</span>
          </div>
          <div class="subtext">Based on device reachability</div>
          <div class="progress-bar-bg">
            <div class="progress-bar-fill" id="availBar"></div>
          </div>
        </div>

        <!-- Quick link to devices page -->
        <div class="card">
          <div class="card-header">
            <span>Inventory</span>
          </div>
          <div class="subtext">Add / remove devices, SSH & Telnet helpers</div>
          <div style="margin-top:8px;">
            <a href="{{ url_for('devices_page') }}" class="btn-link">
              